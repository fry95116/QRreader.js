<head>
    <title>QR reader Demo</title>
    <meta name="viewport" content="width=device-width, user-scalable=no" />

    <link rel="manifest" href="manifest.json" />
    <link rel="stylesheet" type="text/css" href="main.css">
    <!-- 截至ios11.3，暂时不支持manifest.icons -->
    <link rel="apple-touch-icon" href="./e.png" type="image/png" />
    <link rel="icon" href="./e.png" type="image/png" />
    <style>

        .QRreader-mask{
            position: fixed;
            left: 0px;
            top: 0px;
            width: 100%;
            height: 100%;
            background-color: black;
            overflow: hidden;
        }
        
        .QRreader-mask video{
            min-width: 100%;
            min-height: 100%;
            width: auto;
            height: auto;
            position: absolute;
        }

        .content-center{
            position: absolute;
            transform: translateX(-50%) translateY(-50%);
            top: 45%;
            left: 50%;
        }

        .QRreader-mask .aperture{
            position: relative;
            border: 2px solid white;
        }

        .QRreader-mask .aperture .vertex{
            position: absolute;

            width: 10%;
            height: 10%;
        }
        
        .QRreader-mask .aperture .vertex.left-top{
            left: 0;
            top: 0;
            border-left: 4px solid white;
            border-top: 4px solid white;
        }

        .QRreader-mask .aperture .vertex.right-top{
            right: 0;
            top: 0;
            border-right: 4px solid white;
            border-top: 4px solid white;
        }
        
        .QRreader-mask .aperture .vertex.left-bottom{
            left: 0;
            bottom: 0;
            border-left: 4px solid white;
            border-bottom: 4px solid white;
        }
        
        .QRreader-mask .aperture .vertex.right-bottom{
            right: 0;
            bottom: 0;
            border-right: 4px solid white;
            border-bottom: 4px solid white;
        }

        .QRreader-mask .aperture .scan-line{
            position: absolute;
            left: 0;
            margin: 0;
            width: 100%;
            height: 10%;
            background: -webkit-linear-gradient(top,rgba(255, 255, 255, 0),rgba(255, 255, 255, 1));
            animation: scan 1s ease-in-out infinite;
        }

        .QRreader-mask .tips{
            margin-top: 0.5em;
            width: 100%;
            color: #fff;
            text-align: center;
            font-size: smaller;
        }
        .QRreader-mask .btn-cancel{
            position: absolute;
            left: 16px;
            top: 10px;
            margin: 0;
            border: none;
            padding: 0;
            background: transparent;
            font-size: 60px;
            color: white;
            line-height: 1.0;
            outline: none;
        }
        .QRreader-mask .btn-switch{
            position: absolute;
            lreft: 0;
            bottom: 0;
            margin: 0;
            outline: none;
            border: none;
            padding: 24px;
            background: transparent;
            font-size: large;
            color: white;
            line-height: 1.0;

        }

        @keyframes scan{
            from{top:0%;}
            to{top:90%;}
        }

        label[for="qrcode-capture"]{
            display: block;
            margin-top: 1em;
            padding: 0.5em;
            border-radius: 20px;
            text-align: center;
            background-color: blueviolet;
        }
        #qrcode-capture{
            width: 0;
            height: 0;
        }
        
    </style>
</head>

<body>
    <div class="revision">Revision 8</div>
    <img src="pwa-fonts.png">
    <div class="main-text">

    </div>
    <div>
        <label class="btn-scanner" for="qrcode-capture" onclick="return onScanClick()">SCAN QRcode</label>
        <input id="qrcode-capture" type="file" accept="image/*" capture="camera">
    </div>
    <div class="network-message">
        Network:
        <span id="network-status" class="">Good</span>
    </div>
    <script src="QRreader.js"></script>
    <script type="text/javascript">
        // init service worker
        if (navigator.serviceWorker != null) {
            navigator.serviceWorker.register('sw.js')
                .then(function (registration) {
                    console.log('Registered events at scope: ', registration.scope);
                });
        }

        // get network info
        var statusEl = document.querySelector('#network-status')
        if (!navigator.onLine) {
            statusEl.classList = ['is-offline']
            statusEl.innerText = 'Offline'
        }

        // for some reason safari on mac can debug ios safari page but not ios home screen web apps 
    
        var msg = document.querySelector('.main-text')
        msg.innerHTML += getSupportInfo().join('<br>')

        function getSupportInfo(){
            return [
                'navigator : ' + typeof navigator,
                'MediaDevices:' + typeof MediaDevices,
                'navigator.mediaDevices: ' + typeof navigator.mediaDevices,
                'navigator.getUserMedia: ' + typeof navigator.getUserMedia,
                'navigator.webkitGetUserMedia' + typeof navigator.webkitGetUserMedia
            ]
        }

        var qr_reader = new QRreader()
        function onScanClick(){
            if(qr_reader.isSupported()){
                qr_reader._showFrame()
                return false
            }
            else return true
        }
    </script>
</body>