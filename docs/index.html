<head>
    <title>QR reader Demo</title>
    <meta name="viewport" content="width=device-width, user-scalable=no" />

    <link rel="manifest" href="manifest.json" />
    <link rel="stylesheet" type="text/css" href="main.css">
    <!-- 截至ios11.3，暂时不支持manifest.icons -->
    <link rel="apple-touch-icon" href="./e.png" type="image/png" />
    <link rel="icon" href="./e.png" type="image/png" />
    <style>
        .absolute-center{
            position: absolute;
            transform: translateX(-50%) translateY(-50%);
            top: 50%;
            left: 50%;
        }

        .QRreader-mask{
            position: fixed;
            left: 0px;
            top: 0px;
            width: 100%;
            height: 100%;
            background-color: black;
            overflow: hidden;
        }
        
        .QRreader-mask video{
            min-width: 100%;
            min-height: 100%;
            width: auto;
            height: auto;
            position: absolute;
        }

        .QRreader-mask .aperture{
            width: 50%;
            height: 0;
            padding-bottom: 50%;
            border: 2px solid white;
        }

        .QRreader-mask .aperture .scan-line{
            margin:0;
            border: 2px solid white;
            animation: scan 1s ease-in-out infinite alternate;
        }
        
        .QRreader-mask .btn-switch{
            position: absolute;
            width: 40px;
            height: 40px;
            border: 3px solid white;
            border-radius: 50%;
            right: 20px;
            bottom: 20px;
        }

        @keyframes scan{
            from{margin-top:0%;}
            to{margin-top:100%;}
        }

        label[for="qrcode-capture"]{
            display: block;
            width: 50px;
            height: 30px;
            background-color: blueviolet;
        }
        #qrcode-capture{
            width: 0;
            height: 0;
        }

        
    </style>
</head>

<body>
    <div class="revision">Revision 8</div>
    <img src="pwa-fonts.png">
    <div class="main-text">

    </div>
    <div>
        <label class="btn-scanner" for="qrcode-capture" onclick="return onScanClick()"></label>
        <input id="qrcode-capture" type="file" accept="image/*" multiple>
    </div>
    <div class="network-message">
        Network:
        <span id="network-status" class="">Good</span>
    </div>
    <video autoplay="autoplay" muted="muted" playsinline="playsinline"></video>
    <script src="QRreader.js"></script>
    <script type="text/javascript">
        // init service worker
        if (navigator.serviceWorker != null) {
            navigator.serviceWorker.register('sw.js')
                .then(function (registration) {
                    console.log('Registered events at scope: ', registration.scope);
                });
        }

        // get network info
        var statusEl = document.querySelector('#network-status')
        if (!navigator.onLine) {
            statusEl.classList = ['is-offline']
            statusEl.innerText = 'Offline'
        }

        // for some reason safari on mac can debug ios safari page but not ios home screen web apps 
    
        var msg = document.querySelector('.main-text')
        msg.innerHTML += getSupportInfo().join('<br>')

        function getSupportInfo(){
            return [
                'navigator : ' + typeof navigator,
                'MediaDevices:' + typeof MediaDevices,
                'navigator.mediaDevices: ' + typeof navigator.mediaDevices,
                'navigator.getUserMedia: ' + typeof navigator.getUserMedia,
                'navigator.webkitGetUserMedia' + typeof navigator.webkitGetUserMedia
            ]
        }

        var qr_reader = new QRreader()
        function onScanClick(){
            if(qr_reader.isSupported()){
                qr_reader.showFrame()
                return false
            }
            else return true
        }
    </script>
</body>